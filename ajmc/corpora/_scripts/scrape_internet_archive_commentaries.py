from pathlib import Path

from internetarchive import get_item, get_files
from tqdm import tqdm


# This is a list of manually selected ids of commentaries to greek and latin texts
ids = ['bub_gb_TDoPJH28DOkC',
       'indexineustathi00eustgoog',
       'hesiodsworksdays0000rich',
       'commentariiadhom01eust',
       '4737238',
       'commentatiodepi00luebuoft',
       'iliadcommentaryv0006unse',
       'narratologicalco0000jong',
       'euripidouphoini00euriuoft',
       'supplementumari01arisgoog',
       'bub_gb_aw-IxD1dCOwC',
       'comoediae08aris',
       'hin-wel-all-00001271-002',
       'bub_gb_e5Ffccxf4KgC',
       'oxyrhynchuspapyrunse_79',
       'pt7oxyrhynchuspa00grenuoft',
       'xenophontiscomme00xeno',
       'homersodysseeei01goog',
       'scholiaonavesar00whitgoog',
       '4737226',
       'iliadcommentary0002kirk',
       'euripideanfragme00euriuoft',
       'tragoediaequaesu04aescuoft',
       'comoediae09aris',
       'operaomniarecen00xenogoog',
       'tragoediaequaesu02aescuoft',
       'schylitragdiqus00unkngoog',
       'nemeanodespinda01burygoog',
       'thucydidisdebel06thucgoog',
       'pindarsseventhol0000verd',
       'comoediae05aris',
       'anabasisorexped00xeno',
       'commentatiodepi00lbbe',
       'aristophanisnub00bekkgoog',
       'oxyrhynchuspapyr10gren',
       'bub_gb_SPICAAAAMAAJ',
       'xenophontisopera02xeno',
       'oxyrhynchuspapyr03gren',
       'commentarii0000xeno',
       'commentardesvie00homegoog',
       'sophoclesoidipou0000rust',
       'tragoediaequaesu03aescuoft',
       'historicalcommen0001awgo',
       'commentaryonhome0003unse',
       'persians0000aesc',
       'pindaroutasozom00boecgoog',
       'historicalcommen00cart',
       'acharnianswithin00arisuoft',
       'birdsfromtextdi00cookgoog',
       '4737187',
       'bub_gb_8YDG0zbS6_0C',
       'numismaticcommen00imhoiala',
       'avescumprolegome00arisuoft',
       'bub_gb_AqQTAAAAYAAJ',
       'oxyrhynchuspapyr08gren',
       'pindaricarminao01pindgoog',
       'commentatiod00lbbe',
       'in.ernet.dli.2015.283589',
       'pindaricarminao00pindgoog',
       'commentaryonhesi0000verd',
       'in.ernet.dli.2015.283588',
       'thoukyddouxyng00thucuoft',
       'einsthetischerk00sitzgoog',
       'bub_gb_l6sGWO-jjqcC',
       '4737184',
       'pt5oxyrhynchuspa00grenuoft',
       'commentairesurlo00sche',
       'pindarsolympiano0000gerb',
       'sophoclesantigon00sophiala',
       'antigoneantigone00soph',
       'aristophaniscom04unkngoog',
       'carminaquaesuper02pind',
       'desophoclemedici00pauc',
       'pt9oxyrhynchuspa00grenuoft',
       'euripides0000euri',
       'bub_gb_RyXT5bYY6KEC',
       'hesiodiaquaevoca00rhod',
       'xenophontiscomm01dindgoog',
       'plutusaristopha01arisgoog',
       'hirontexteettrad00xeno',
       'pausaniassdescri05pausuoft',
       'oxyrhynchuspapyr01grenuoft',
       'p2pindaroutasozo02pinduoft',
       'commentatiodeae00aescgoog',
       'coephorigreekeng00aescuoft',
       'oxyrhynchuspapyr04gren',
       'pindaricarminac02pindgoog',
       'commentaryonthuc0002horn',
       'degraecourmvete00grafgoog',
       'oedipusrexquote00liongoog',
       '4766206',
       'oxyrhynchuspapyr02gren',
       'oxyrhynchuspapyr07gren',
       '4737237',
       'twentiethcentury0000obri',
       'oxyrhynchuspapyr01gren',
       'bub_gb_BMEzAQAAMAAJ',
       '28-ijels-104202012-acritical',
       'bub_gb_0ROggnSKwmMC',
       'thucydidesbook00thuc1886',
       'commentariiadhom02eust',
       'agamemnongriechi00aescuoft',
       'commentatiode00lbbe',
       'dearistarchistu00horngoog',
       'hellenica01xeno',
       'depindaricarmini00leutuoft',
       'commentatiodeor02rettgoog',
       '4737170',
       'comediesplutusa00arisgoog',
       'septtragdiesdeu00weilgoog',
       'pentalogiagrcas00eurigoog',
       'firstthreebooks03homegoog',
       'tragoediaesepte02soph',
       'bub_gb_wxEQcMVuD_IC',
       'homersiliadwithp00snidrich',
       'workspindar00pindgoog',
       'bub_gb_EpCu78vrgiwC',
       'commentarzuthuc01tillgoog',
       'commentaryonhome0001unse',
       'bub_gb_WRANv_dWIMwC',
       'oxyrhynchusppt1300grenuoft',
       'lukianrhetorumpr0000zwei',
       'pindarioperaqua01dissgoog',
       'commentaryonplay0000hoga',
       'commentarzuthuc00tillgoog',
       'euripidesherakle0000wila',
       'oxyrhynchuspapyr13gren',
       'agamemnonagamemn00aescuoft',
       'commentationumpi00rauc',
       'oxyrhynchuspapt12grenuoft',
       'oxyrhynchuspapyr11gren',
       'commentatiodepin00lbbe',
       'historypeloponn00tiddgoog',
       'aristophanisco01aris',
       'sevenagainsttheb0000edtr',
       'oxyrhynchuspapyr06gren',
       'oxyrhynchuspappt02grenuoft',
       'bub_gb_3MmuuWUEqxQC',
       'sophoclisqueexst03soph',
       'einsthetischerk01sitzgoog',
       'scholiaonavesar01whitgoog',
       'lysistratawomens0000aris',
       'aeschylusorestei0000cona',
       'commentatiodepri00lbbe',
       'commentationesho00leeu',
       'choephori0000aesc',
       'worksdays0000hesi_r7b9',
       'cu31924051247140',
       'pindaricarminap00pindgoog',
       'cu31924096693217',
       'anabasisorexped00xenogoog',
       'odespindarineng00westgoog',
       'acharniansofaris0000aris',
       'tragediesreedite00aescuoft',
       'tragdiesdesoph00soph',
       'recapturingsopho0000tyrr',
       'wasps01arisgoog',
       'aristophanisaves00arisuoft',
       'sba5_20210825',
       'aristophanisves01arisgoog',
       'pt1pindaroutasoz02pind',
       'antigoneofsophoc0000unse',
       '4737243',
       'pindaricacomment00herw',
       '4737185',
       'diegeschichtedek01thucuoft',
       'odespindarineng01pindgoog',
       'epicsofhesiodwit00hesiuoft',
       'commentariiadho02eust',
       'wasps00merrgoog',
       'oxyrhynchuspapyr0047unse',
       'rubelliusplautu00wolfgoog',
       'acharniansofaris00renn',
       'aeschyliquaesup01aescgoog',
       'clouds00arisgoog',
       'playsofsophocles0000kame',
       '4737171',
       'beitrgezueinemco00hirs',
       'ecclesiazusaecum00arisuoft',
       'euripideskrespho0000hard',
       'elektranachtext00sophgoog',
       'bwb_P8-AKU-585',
       'EumenidesOfAeschylus',
       'homersodysseycom0000jone',
       'homersodysseywi00homegoog',
       'cu31924026465777',
       '9789004694132-69449',
       'phoenisseuripid00majogoog',
       'commentariicrit00benegoog',
       'trent_0116404549622_8',
       'xenophontiscomm00xenogoog',
       'commentariiadhom04eust',
       'bub_gb_Gh1GsNFI2FYC',
       'acommentarywith00undegoog',
       'bub_gb_qHKLg73H25QC',
       'aristophanisequ01leeugoog',
       'pindaricarminae00hermgoog',
       'pindaricarminap01chrigoog',
       'notaephilologica01tg',
       'comoediae06aris',
       'guidetosophocles0000obri',
       'cu31924091301238',
       'oxyrhynchuspapyr0066unse',
       'hesioditheogonia0000hesi',
       'commentatiodeae00toepgoog',
       'commentariiadho01eust',
       'historicalcommen0000gomm',
       'aristophanouseir00arisuoft',
       'commentariicrit00hudegoog',
       'bim_eighteenth-century_aischylou-prometheus-des_aeschylus_1767',
       'oedipustyrannuso00sophiala',
       'cu31924026466403',
       'bub_gb_N8cNAAAAYAAJ',
       'pindaricarminap00chrigoog',
       'medeaelectranote0000milc',
       'iliadcommentary0000kirk',
       'bub_gb_gY_mzAq8ThMC',
       'euripideswitheng0002pale',
       'acharnensescumpr00arisuoft',
       'bub_gb_OX0evVaenocC',
       'ueberdasrhetori02hirzgoog',
       'commentationesh00creugoog',
       'homersodyssee00unkngoog',
       'bub_gb_sk0TAAAAYAAJ',
       'hesioditheogoni02hesigoog',
       'bub_gb_dVBG_S10v2wC',
       'bub_gb_8oU5AQAAMAAJ',
       'commentatiodep00lbbe',
       'aeschylusprometh00cona',
       'comoediae04aris',
       'supplementumsoph00soph',
       'theogoniemiteinl00hesiuoft',
       'lucianisamosaten22luci',
       '4630637',
       'lestragdiesdeso00tourgoog',
       '4774739',
       'commentatiodear00thomgoog',
       'lodyssedhomrete00homegoog',
       '4737166',
       'TheOxyrhynchusPapyrieditedWithTranslationsAndNotesByBernardP',
       'hesioditheogoni00lenngoog',
       'bub_gb_99sKf7pSg68C',
       'sophoclesplaysfr03soph',
       'herakles01moegoog',
       'beitrgezueinem00hirsuoft',
       'prometheusbound05aescgoog',
       'oxyrhynchuspapyr12gren',
       '4737165',
       'commentaryonhome0000will',
       'desophoclearoma00gensgoog',
       'commentariiadhom03eust',
       'lysiorationesqu00lysigoog',
       'agamemnonofaesch00aescrich',
       'agamemnoncumsch00haupgoog',
       'bub_gb_3TgaARE1nCsC',
       'englishcommentar0000char',
       'bub_gb_dC9GD8dfTEUC',
       'orestes0000euri_n5n7',
       'bub_gb_FSk-AAAAcAAJ',
       'historicalcommen0000gomm_p1l7',
       '4737179',
       'platossymposiu00plat',
       'eightbooksofhome00homeiala',
       'iliadbookone0000home',
       'oxyrhynchuspapyr14gren',
       'aclassicalmanua00unkngoog',
       'phoenissaeofeuri00euriuoft',
       'cu31924087935817',
       'firstthreebooks00homegoog',
       'oxyrhynchuspapy00huntgoog',
       'commentatiodepin00lbuoft',
       'aristophaniscom00librgoog',
       'supplementumaris02akad',
       'gxenofntospomny00xenogoog',
       'operaomnia02xeno',
       'jstor-4423944',
       'elegiesoftheogni00theouoft',
       'elegiesothereleg00theouoft',
       'theognidisreliq00theogoog',
       'theognidisreliq02theogoog',
       'theognidisreliq00welcgoog',
       'KirkHeraclitus.TheCosmicFragments',
       'artthoughtofhera0000kahn',
       'ljs203',
       'A332063',
       'inaristotelisdec07simp',
       'philippianscomme0000holl',
       'commentaryonplat0000fici',
       'greekcommentarie0002unse',
       'proclus-commentary-on-plato-republic-volume-1',
       'jbc.bj.uj.edu.pl.NDIGORP000799',
       'proclidiadochiin01procuoft',
       'protagorascumpro00platuoft',
       'protagoraswithth00platuoft',
       'bub_gb_SIZyv9cpXjkC',
       'proclusontimaeus01procuoft',
       'alfred-edward-taylor-a-commentary-on-platos-timaeus-clarendon-press-1928',
       'inplatonisrempu02krolgoog',
       'kritischercommen00schm',
       'acompaniontopla00bosagoog',
       'commentaireparme0000dama',
       'platogorgiasrevi0000erdo',
       'bub_gb_2gRmR3i6SYoC',
       'bub_gb_FOFRAAAAcAAJ',
       'commentairesurl00platgoog',
       'commentaryonplat0000hawt',
       'cu31924030430379']

root_dir = Path('/mnt/ajmcdata1/data/ia_commentaries')
data_dir = root_dir / 'data'
data_dir.mkdir(exist_ok=True, parents=True)

missed = []
for id_ in tqdm(ids):
    item = get_item(id_)
    file = [f for f in get_files(id_) if f.metadata['name'].endswith('jp2.zip') or f.metadata['name'].endswith('tif.zip')]

    if not file:
        print(f'No file for {id_}')
        print(get_files(id_))
        missed.append(id_)

    else:
        file = file[0]
        output_path = data_dir / file.metadata['name']

        if output_path.exists():
            print(f"Skipping {id_}")
        else:
            try:
                file.download(str(output_path))
            except Exception as e:
                print(e)
                print(f"Failed to download {id_}")
                missed.append(id_)

(root_dir / 'missed.txt').write_text('\n'.join(missed))
